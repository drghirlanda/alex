\documentclass[11pt,]{article}
\usepackage[T1]{fontenc}
\usepackage{mathptmx,setspace}
\renewcommand{\medskip}{}
\usepackage{hyperref}
\usepackage{amssymb,amsmath}
\usepackage[utf8]{inputenc}
\usepackage[shrink=30,stretch=0]{microtype}
\usepackage[compact]{titlesec}
\usepackage[margin=1in]{geometry}
% nothing, we use table rather than longtable
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={Stefano Ghirlanda},
            pdftitle={Alex: Associative Learning EXperiments},
            colorlinks=true,
            urlcolor=blue,
            linkcolor=magenta,
            pdfborder={0 0 0}}
\urlstyle{same}  % don't use monospace font for urls
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\setcounter{secnumdepth}{0}

\title{Alex: Associative Learning EXperiments}
\author{Stefano Ghirlanda}
\date{}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{3}
\begin{spacing}{0}
\small
\tableofcontents
\end{spacing}
\clearpage
}
\section{Introduction}

Alex is a program to run associative learning experiments described in
configuration files. This manual describe how to configure experiments.
Please refer to the README file that comes with alex for installation
instructions. The README also describes in brief what alex can and
cannot do.

\subsection{Workflow}

To build and run a new experiment you create a dedicated folder, say,
MyExperiment, and within it the following subfolders:

\begin{itemize}
\item
  \textbf{Design}: This folder contains the files that specify
  experimental design, such as which stimuli to use, the structure of
  trials, and different treatments for subjects. See
  \hyperref[configuration-files]{Configuration files}.
\item
  \textbf{Materials}: Here you have any image, sound, or text files you
  need for your experiment, including an Instructions.txt file for the
  initial instructions.
\item
  \textbf{Data}: This folder is created by alex if it is not found, and
  it holds the data collected during experiment runs.
\end{itemize}

The program \texttt{alex-init} generates a bare-bones experiment so that
you know what files you need. It is run like this:

\begin{verbatim}
alex-init -v <experiment name>
\end{verbatim}

This creates folder with the above mentioned subfolders and skeleton
configuration files.

\subsection{Acknowledgments}

Alex is written using Shane Mueller's
\href{http://pebl.sourceforge.net}{Psychology Experiment Building
Language} (PEBL). Many thanks to Shane for sharing PEBL!

\section{Starting and stopping alex}

From the folder where the Design and Materials folders are, you can just
type `alex'. You can also run experiments in other folders using:

\begin{verbatim}
alex -v <folder>
\end{verbatim}

The \texttt{\textless{}folder\textgreater{}} is then expected to have
Design and Materials subfolders with appropriate files. A Data folder
will be create if not present.

Alex has been designed so that multiple instances of an experiment can
be run simultaneously. This feature is useful when the experiment folder
is shared among multiple computers, as it may occur in a lab. All
instances of alex will read the same design files, and in particular the
same \texttt{Groups.csv} file which describes how to run subjects.
Different instances, however, will run different subjects and will not
overwrite each other's data files.

The fact that a subject has been run is signaled by the existence of the
corresponding data file (see \hyperref[data-format]{Data format}). If
the experiment is interrupted before it completes, alex will still
consider that subject as having been run. It is up to you to check that
data files are complete (you can check that they have the appropriate
number of lines, for example). Although this may be inconvenient at
times, it is hard to improve upon this situation, because there is no
way for alex to decide whether important data would be overwritten by
re-running a subject. If you decide a data file is worthless, either
remove it or rename it with something like an `incomplete-' prefix, and
alex will automatically re-run that subject.

If you want to interrupt a running experiment, you can use the standard
interrupt key comination for PEBL:
\texttt{Ctrl+Alt+Shift+\textbackslash{}}.

\hyperdef{}{configuration-files}{\section{Configuration
files}\label{configuration-files}}

All configuration files are in the Design folder:

\begin{itemize}
\item
  \texttt{Phases.csv} describe the experimental design proper. I
  containes one or more experimental phases, each composed of a number
  of trials in which stimuli are presented, responses recorded, and
  outcomes delivered.
\item
  \texttt{Stimuli.csv} defines the stimuli that are mentioned
  \texttt{Phases.csv}. The latter only mentions stimuli by name, while
  \texttt{Stimuli.csv} informs alex of what the stimuli actually are.
\item
  \texttt{Groups.csv} defines the number of experimental groups and the
  treatments to which subjects in each group are allocated.
\item
  \texttt{Parameters.csv} defines some global parameters such as screen
  background color, text color, font, and size, the duration of
  inter-trial intervals, and so on. Can also be used to define
  parameters that are the same for all stimuli, such as which key is
  used for responses.
\end{itemize}

In addition, instruction files can be in Materials, see the
\hyperref[textfiles]{section on text files}.

\subsection{The \texttt{Phases.csv} file}

Suppose we want to teach participants to discriminate a red square from
a white square. We then want to know how subjects respond to, say, a
pink square. Table \ref{phases} shows how a suitable \texttt{Phases.csv}
file might look like.\footnote{In this manual, we use tables to display
  design files in a readable form. These files, however, are actually
  comma-separated-values (CSV) files. You can edit CSV files in any
  spreadhseet using the CSV format for saving. Alex wants double quotes
  (if needed) in CSV files. Single quotes will result in errors. (This
  comes from the PEBL function that reads CSV files.) Most spreadhseet
  software uses double quotes by default, but do check in case alex
  cannot read your CSV files.} The file describes an experiment with two
phases. Each line describes one type of trial that occurs in a phase.
There are, for example two kinds of trials in phase 1, specifying 20
presentations of each of two stimuli, called Red and White. Red will be
rewarded 90\% of the time, White only 10\%. On reward trials, stimulus
Smiley will be displayed as the reward (US). In phase 2, stimulus Pink
is presented five times. When the experiment is run, Red and White
trials will be intermixed randomly because they all pertain to phase 1.
Pink trials on the other hand, will be performed in phase 2 after all
phase 1 trials have been run.

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}lllll@{}}
\hline\noalign{\medskip}
Phase & Stimulus & Trials & Reward & US
\\\noalign{\medskip}
\hline\noalign{\medskip}
1 & Red & 20 & 0.9 & Smiley
\\\noalign{\medskip}
1 & White & 20 & 0.1 & Smiley
\\\noalign{\medskip}
2 & Pink & 5 & 0 &
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A simple \texttt{Phases.csv} to teach a discrimination between
stimuli Red and White, and then testing responding to Pink. Note that
the US field can be left empty if the Reward probability is 0.
\label{phases}}
\end{center}\end{table*}

\textbf{Note:} Phases are run in the order they are defined, not in
their numerical or alphabetical order (thus you can use descriptive
names like Training, Testing, etc). To be more precise, phases are run
in the order in which their \emph{first} stimuli are defined. For
example, the phases file in Tables \ref{phases} and \ref{phases-order1}
are equivalent, but the file in Table \ref{phases-order2} runs phase 2
before phase 1.

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}lllll@{}}
\hline\noalign{\medskip}
Phase & Stimulus & Trials & Reward & US
\\\noalign{\medskip}
\hline\noalign{\medskip}
1 & Red & 20 & 0.9 & Smiley
\\\noalign{\medskip}
2 & Pink & 5 & 0 &
\\\noalign{\medskip}
1 & White & 20 & 0.1 & Smiley
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{With this \texttt{Phases.csv} file, alex will run phase 1
before phase 2 (cf.~Table \ref{phases-order2}. \label{phases-order1}}
\end{center}\end{table*}

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}lllll@{}}
\hline\noalign{\medskip}
Phase & Stimulus & Trials & Reward & US
\\\noalign{\medskip}
\hline\noalign{\medskip}
2 & Pink & 5 & 0 &
\\\noalign{\medskip}
1 & Red & 20 & 0.9 & Smiley
\\\noalign{\medskip}
1 & White & 20 & 0.1 & Smiley
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{With this \texttt{Phases.csv} file, alex will run phase 2
before phase 1 (cf.~Table \ref{phases-order1}. \label{phases-order2}}
\end{center}\end{table*}

\subsection{The \texttt{Stimuli.csv} file}

In the \texttt{Phases.csv} files in Tables
\ref{phases}--\ref{phases-order2}, how does alex know that Red, White,
and Pink represent red, white and pink squares, and that Smiley is a
smiley face? This information is contained in the \texttt{Stimuli.csv}
file, see Table \ref{stimuli}.

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}llllll@{}}
\hline\noalign{\medskip}
Name & Type & Parameters & Color & XOffset & YOffset
\\\noalign{\medskip}
\hline\noalign{\medskip}
Red & square & 50 & red & 0 & 0
\\\noalign{\medskip}
White & square & 50 & white & 0 & 0
\\\noalign{\medskip}
Pink & square & 50 & 255,128,128 & 0 & 0
\\\noalign{\medskip}
Smiley & image & smile-o-white.png & & 0 & -150
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Stimuli.csv} file instructing alex that stimuli Red,
White, and Pink are colored squares 50 pixels in side, and with
different colors, and that Smiley is an image contained in file
\texttt{smile-o-white.png}. \label{stimuli}}
\end{center}\end{table*}

The fields in Table \ref{stimuli} should be fairly intuitive, but here
is a detailed explanation:

\begin{itemize}
\item
  \textbf{Name}: An arbitrary label for the stimulus, so that it can be
  referenced in \texttt{Phases.csv}. It can be anything that does not
  contain the characters " (double quote), + (plus), * (asterisk), :
  (colon), and , (comma). These characters are reserved for special
  operations described below.
\item
  \textbf{Type}: This can be square, circle, text, textfile, image, or
  sound.
\item
  \textbf{Parameters}: The meaning of parameters varies according to the
  stimulus type:
\item
  square: side in pixels.
\item
  circle: radius in pixels.
\item
  text: the text to be displayed.
\item
  textfile: name of a file in the Materials folder where the desired
  text is stored.
\item
  image or sound: name of a file in the Materials folder that contains
  the image or sound. An optional zoom factor can be provided to scale
  the image to a desired size. It should be separated from the filename
  by a \texttt{+} sign. The following stylized faces (smileys) come with
  alex and you can use them without having them in the Materials folder:

  \begin{itemize}
  \item
    smile-o-white.png: a happy face, as used above
  \item
    meh-o-white.png: a neutral face
  \item
    frown-o-white.png: a sad face
  \end{itemize}

  These images are drawn in white over a transparent background;
  equivalent white images are available as smile-o.png, etc. All images
  have been taken from
  \href{http://fortawesome.github.io/Font-Awesome}{Font Awesome}, via
  \href{https://github.com/encharm/Font-Awesome-SVG-PNG}{this project}.
  They are 256x256 pixels in size to look OK even on high resolution
  monitors. If that is too big for you, yu can zoom them as indicated
  above.
\item
  \textbf{Color}: the color of squares, circles, or text. This field is
  ignored for images and sounds. Colors can either be named or given as
  an RGB triplet. As the latter are themselves comma-separated lists,
  they need to be double-quoted in the CSV file (spreadhseet software
  will do this for you). In the case of text, you can specify the
  background as well as the foreground color by writing the color in the
  form Color1+Color2, where Color1 will be foreground and Color2 the
  background. If no foreground or background color is given, the default
  set in \texttt{Parameters.csv} is used.
\end{itemize}

The PEBL reference manual lists valid color names, which are many
hundreds. If you stick to simple stuff like red, blue, cyan, purple, and
so on, you can get by without consulting this file. RGB, of course,
enables you to define color shades more precisely.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  \textbf{XOffset} and \textbf{YOffset}: offsets from the center of the
  screen, in pixel. In the example, all stimuli are centered but the
  reward stimulus Smiley, which is displayed 150 pixels above center
  (``above'' is negative Y values).
\end{itemize}

\subsection{The \texttt{Groups.csv} file}

The \texttt{Groups.csv} file contains information about the experimental
groups you want to run. If all subjects undergo the same treatment, you
only to specify one group and its size. The file in Table
\ref{subjects}, for example, instructs alex to run a single groups of 10
subjects (groups can be numbered or named, as is most convenient to
you). Often, however, subjects need to be divided in different treatment
groups. Any of the fields in the \texttt{Stimuli.csv} file can be
specified on a per-subject bases. If you want to test two shades of
pink, for example, you would extend the \texttt{Stimuli.csv} file in
Table \ref{stimuli-color}. The special notation *Pink demonstrated there
indicates that the color of stimulus Pink will be looked up, for each
subject, in the column PinkColor of the \texttt{Groups.csv} file (Table
\ref{subjects-color}). This syntax is available for all stimulus
properties. For example, to change the size of Red square across
subjects you would use the \texttt{Groups.csv} and \texttt{Stimuli.csv}
files in Tables \ref{subjects-color-parameters} and
\ref{stimuli-color-parameters}.

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}ll@{}}
\hline\noalign{\medskip}
Group & Size
\\\noalign{\medskip}
\hline\noalign{\medskip}
1 & 10
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Groups.csv} file instructing alex to run 6 subjects.
\label{subjects}}
\end{center}\end{table*}

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}llllll@{}}
\hline\noalign{\medskip}
Name & Type & Parameters & Color & XOffset & YOffset
\\\noalign{\medskip}
\hline\noalign{\medskip}
Red & square & 50 & red & 0 & 0
\\\noalign{\medskip}
White & square & 50 & white & 0 & 0
\\\noalign{\medskip}
Pink & square & 50 & *Pink & 0 & 0
\\\noalign{\medskip}
Smiley & image & smiley-o-white.png & & 0 & 150
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Stimuli.csv} file instructing alex to look up the
Color of the Pink stimulus in the \texttt{Groups.csv} file.
\label{stimuli-color}}
\end{center}\end{table*}

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}lll@{}}
\hline\noalign{\medskip}
Group & Size & PinkColor
\\\noalign{\medskip}
\hline\noalign{\medskip}
1 & 10 & 255,128,128
\\\noalign{\medskip}
2 & 10 & 255,190,190
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Groups.csv} file instructing alex to run 6 subjects
split in two treatment groups with different Color attributes for the
Pink stimulus (see Table \ref{stimuli-color}). \label{subjects-color}}
\end{center}\end{table*}

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}llllll@{}}
\hline\noalign{\medskip}
Name & Type & Parameters & Color & XOffset & YOffset
\\\noalign{\medskip}
\hline\noalign{\medskip}
Red & square & *Red & red & 0 & 0
\\\noalign{\medskip}
White & square & 50 & white & 0 & 0
\\\noalign{\medskip}
Pink & square & 50 & *Pink & 0 & 0
\\\noalign{\medskip}
Smiley & image & smiley-o-white.png & & 0 & 150
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Stimuli.csv} file instructing alex to run look up in
the \texttt{Groups.csv} file both the Color of stimulus Pink and the
Parameters of stimulus Red (see Table \ref{subjects-color-parameters}).
\label{stimuli-color-parameters}}
\end{center}\end{table*}

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}llll@{}}
\hline\noalign{\medskip}
Group & Size & PinkColor & RedParameters
\\\noalign{\medskip}
\hline\noalign{\medskip}
1 & 10 & 255,128,128 & 25
\\\noalign{\medskip}
2 & 10 & 255,128,128 & 50
\\\noalign{\medskip}
3 & 10 & 255,190,190 & 50
\\\noalign{\medskip}
4 & 10 & 255,190,190 & 75
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Groups.csv} file instructing alex to run 4
experimental groups. Each group receives a unique combination of
PinkColor and RedParameters (see Table \ref{stimuli-color-parameters}).
\label{subjects-color-parameters}}
\end{center}\end{table*}

\subsection{The \texttt{Parameters.csv} file}

The \texttt{Parameters.csv} file contains some parameters that affect
the whole experiment. Here is a sample file (as above, the file is in
CSV format, displayed here as a table for legibility):

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}ll@{}}
\hline\noalign{\medskip}
Parameter & Value
\\\noalign{\medskip}
\hline\noalign{\medskip}
CSDuration & 4000
\\\noalign{\medskip}
CSUSInterval & 0
\\\noalign{\medskip}
USDuration & 400
\\\noalign{\medskip}
Response & space
\\\noalign{\medskip}
ResponseTimeMin & 0
\\\noalign{\medskip}
ResponseTimeMax & 4000
\\\noalign{\medskip}
MinITI & 1000
\\\noalign{\medskip}
MaxITI & 3000
\\\noalign{\medskip}
MaxResponses & 100
\\\noalign{\medskip}
BackgroundColor & gray95
\\\noalign{\medskip}
ForegroundColor & black
\\\noalign{\medskip}
FontName & Vera
\\\noalign{\medskip}
FontSize & 36
\\\noalign{\medskip}
Test & 0
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{Sample \texttt{Parameters.csv} file with default values for
parameters.}
\end{center}\end{table*}

\textbf{CSDuration} is the default duration of all the non-US stimuli,
while \textbf{USDuration} is the default duration of all US stimuli. All
durations are in milliseconds. Note that you can set different durations
for different stimuli by including a Duration column in the
\texttt{Stimuli.csv} file. When using compound stimuli, all components
must have the same duration.

\textbf{CSUSInterval} and \textbf{USDuration} should be
self-explanatory.

\textbf{ReactionTimeMin} and \textbf{ReactionTimeMax} define at what
times within a trial subjects can respond. Responses outside this time
window are registered with a special code (see
\hyperref[data-format]{Data format}) no USs are delivered. If not
specified, ResponseTimeMin is set to 0 and ResponseTimeMax to
CSDuration, thus allowing responses anywhere in the trial.

\textbf{MinITI} and \textbf{MaxITI} are the minimum and maximum values
of the inter-trial interval. Each inter-trial interval will be drawn
between these values with uniform distribution.

\textbf{Response} is the key subjects are instructed to press if they
want to respond. Note that this can also be set on a per-stimulus basis,
see \hyperref[responses]{here}.

\textbf{MaxResponses} is the maximum number of response a subject is
allowed to make in one trial. There are essentially two useful settings.
If you set this to 1 the trial ends with the first response (the US is
delivered if appropriate, of course). If you set it to an
unrealistically large value, say 1000, you can record any number of
responses per trial. Each of these may result in the US being delivered,
as described above. Note that you can set MaxReponses to a different
value for different trial types, by including a MaxResponses column in
\texttt{Phases.csv} (see the \hyperref[textfiles]{section on text files}
for an example). If a MaxResponses column exists, but the value is empty
for some stimuli, the MaxResponses value in \texttt{Parameters.csv} will
be looked up. If MaxResponses is not set there, it is given a default
value of 1.

The next few parameters control the screen background color while the
experiment is running and the color, font, and size of text used for
instructions and other messages.

The \textbf{Test} parameter, if set to 1, skips instructions and
acquisition of demographic information. It is meant to quickly start the
experiment during development.

\section{Special notation for stimuli}

We mentioned above one bit of special notation in the definition of
stimuli, namely the construction * (star) + stimulus name (see the end
of the previous section). There are two more bits of special notation,
explained next.

Sometimes we want some stimuli to share characteristics. For example,
they should be of the same color. We can express the fact that we want a
stimulus characteristic to equal that of another stimulus using a colon
(:) followed by the stimulus name (we would have liked to use = rather
than :, but unfortunately spreadsheet software stubbornly interprets =
as introducing a formula). Consider the example above, with three
squares of the same size as stimuli. The file in Table
\ref{stimuli-special} is equivalent but uses colon notation for the
Parameters field. This has two advantages: it makes explicit our
intention of having three squares of equal size, and it reduces the
possibility of typing errors.

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}llllll@{}}
\hline\noalign{\medskip}
Name & Type & Parameters & Color & XOffset & YOffset
\\\noalign{\medskip}
\hline\noalign{\medskip}
Red & square & 50 & red & 0 & 0
\\\noalign{\medskip}
White & square & :Red & white & 0 & 0
\\\noalign{\medskip}
Pink & square & :Red & *Pink & 0 & 0
\\\noalign{\medskip}
Smiley & image & smiley-o-white.png & & 0 & 150
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Stimuli.csv} file demonstrating the * and : special
notations for stimuli. \label{stimuli-special}}
\end{center}\end{table*}

Another bit of special notation is + (plus), which is used to present
stimuli together (compound stimuli). Suppose that, after training a
discrimination between red and white squares, we want to test the red
and white squares together. We would then use the files in Tables
\ref{phases-plus} and \ref{stimuli-plus}.

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}lllll@{}}
\hline\noalign{\medskip}
Phase & Stimulus & Trials & Reward & US
\\\noalign{\medskip}
\hline\noalign{\medskip}
1 & Red & 20 & 0.9 & Smiley
\\\noalign{\medskip}
1 & White & 20 & 0.1 & Smiley
\\\noalign{\medskip}
2 & Red+White & 5 & 0 &
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Phases.csv} file with a compound stimulus in phase 2.
\label{phases-plus}}
\end{center}\end{table*}

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}llllll@{}}
\hline\noalign{\medskip}
Name & Type & Parameters & Color & XOffset & YOffset
\\\noalign{\medskip}
\hline\noalign{\medskip}
Red & square & 50 & red & 0 & 0
\\\noalign{\medskip}
White & :Red & :Red & white & 60 & :Red
\\\noalign{\medskip}
Smiley & image & smiley-o-white.png & & 0 & 150
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Stimuli.csv} file to go with the \texttt{Phases.csv}
file in Table \ref{phases-plus}. Note that we need to offset the white
square, otherwise it would overlap with the red one when the two are
presented together. \label{stimuli-plus}}
\end{center}\end{table*}

\textbf{Note:} The + notation is also valid for USs. This can be used to
implement USs of different ``magnitude.'' For example, one can instruct
subjects that each smiley face represents a point earned, and have
multiple smileys appear for more valuable stimuli (this requires
defining several smiley stimuli offset from each other, so that they do
not overlap when displayed simultaneously). Compounding of USs may also
be used to present a combination of a visual and auditory US.

\section{Background stimuli}

It is sometimes desirable to have a particular stimulus present at all
times during one or more experimental phases, for example as a
background on which others are superimposed. A stimulus with the name
``Background'' followed by the name of a phase (from
\texttt{Phases.csv}) will be displayed for the entire duration of that
phase. Different phases can have different backgrounds. In the
\texttt{Stimuli.csv} file, a background stimulus must be defined
\textbf{before} the stimuli one wants to superimpose on the background,
otherwise the background will actually be displayed on top of other
stimuli, potentially obscuring the,.

Note that, despite their name, background stimuli do not need to cover
the whole screen or even be large. They can be any stimulus one wishes
to display throughout a particular experimental phase, including sounds
and texts.

\section{Responses and classical vs.~instrumental trials}

If we wish to record only one kind of response, e.g., space bar presses,
the Response key can be specified in the \texttt{Parameters.csv} file.
We can also, however, specify different responses for different stimuli
by adding a Response column to the \texttt{Phases.csv} file. For
example, to specify that the left arrow key is the correct response for
stimulus Red, but the right arrow is correct for White, you would write
as in Table \ref{responses}.

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}llllll@{}}
\hline\noalign{\medskip}
Phase & Stimulus & Trials & Reward & US & Response
\\\noalign{\medskip}
\hline\noalign{\medskip}
1 & Red & 20 & 1 & Smiley &
\\\noalign{\medskip}
1 & White & 20 & 1 & Smiley &
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Phases.csv} specifying different responses for
stimuli Red and White. \label{responses}}
\end{center}\end{table*}

Here \texttt{\textless{}left\textgreater{}} and
\texttt{\textless{}right\textgreater{}} are special codes that denote
the left and right arrow key. You can look up the codes for different
special keys in the ``Keyboard Entry'' section of the PEBL manual. If
you only want to use letter and number keys, you simply can write the
letter or number as a Response.

There are two special response codes. One is \texttt{space}, indicating
a space bar press. We made this special because the space would be hard
to see when editing the CSV file.

The other special response code is obtained by prefixing the response
with a * (asterisk). This means that the US will be displayed
\emph{only} at the end of the trial (with the appropriate Reward
probability) \emph{regardless} of what the subject does during the
trial, as in classical conditioning or causal rating studies. Thus the
\texttt{Phases.csv} file in Table \ref{classical} specifies that Red is
to be rewarded 90\% of the time at the end of a trial, \emph{regardless}
of whether the subject responds or not. Note that subject responses are
still recorded, and if they exceed the allowed maximum the trial
terminates without reward. This last feature makes it possible to
implement omission training, i.e., reward subjects only when they
abstain from responding. This is controlled by the
\hyperref[maxresponses]{MaxResponses} parameter. The default value is 1,
which corresponds precisley to omission training. If you don't want the
trial to ever terminate before the allotted time, you can use a value of
MaxResponses so high that it cannot be possibly reached, such as 1000.

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}llllll@{}}
\hline\noalign{\medskip}
Phase & Stimulus & Trials & Reward & US & Response
\\\noalign{\medskip}
\hline\noalign{\medskip}
1 & Red & 20 & .9 & Smiley & *space
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Phases.csv} file using the Response notation *space
to indicate a classical conditioning trial in which the US is delivered
at the end of the trial regardless of subject behavior.
\label{classical}}
\end{center}\end{table*}

Note also that on * trials, the ResponseTimeMin and ResponseTimeMax
features are disabled (see \hyperref[global]{Global parameters}).
Because the US (if any), is delivered only once at the end of the trial,
it is irrelevant when subjects responds.

\section{Instructions and other text displays}

Instructions or other longish text can be displayed with the textfile
stimulus type. For example, to include both a start and an end message
(say a `thank you' or similar) you can use \texttt{Phases.csv} and
\texttt{Stimuli.csv} file like those in Tables \ref{phases-instructions}
and \ref{stimuli-instructions} to include the presentation of text files
that are displayed until the subject responds once. As you see in these
Tables, the display of instructions is construed simply as a stimulus
that stays on for a long time (here 10 minutes), unless the subject
performs the required response (which, by default, is the space bar).
The Start.txt and End.txt files will be looked for in the Materials
folder of the experiment. Note the column MaxResponses in
\texttt{Phases.csv}, which makes sure the user has to press the space
bar (the default response) only once to move on, even if a larger number
of responses is allowed for actual experimental trials.

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}llll@{}}
\hline\noalign{\medskip}
Phase & Stimulus & Trials & MaxResponses
\\\noalign{\medskip}
\hline\noalign{\medskip}
Start & StartText & 1 & 1
\\\noalign{\medskip}
End & EndText & 1 & 1
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Phases.csv} file for displaying to subjects
instructions and a final message (see also Table
\ref{stimuli-instructions}.}
\end{center}\end{table*}

\begin{table*}[t]\begin{center}\small\begin{tabular}{@{}lllllll@{}}
\hline\noalign{\medskip}
Name & Type & Parameters & Color & XOffset & YOffset & Duration
\\\noalign{\medskip}
\hline\noalign{\medskip}
StartText & textfile & Start.txt & & & & 600000
\\\noalign{\medskip}
EndText & textfile & End.txt & & & & 600000
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\end{tabular}\caption{A \texttt{Stimuli.csv} file for displaying to subjects
instructions and a final message (see also Table
\ref{phases-instructions}.}
\end{center}\end{table*}

\hyperdef{}{data-format}{\section{Data Format}\label{data-format}}

When you run an experiment with alex, data are saved in the Data folder
(which alex creates if it does not find) in CSV files named with group
names and subject numbers, e.g., \texttt{Data/Training-1.dat} for the
first subject of group Training. These files have a header followed by
one data line per response. This is so that each line identifies all
variables it pertains to (so called ``long format'' in statistical
software) and can be loaded easily into statistical software without
having to manually add data.

The first few columns of each data line replicate the
\texttt{Groups.csv} line for the particular subject. The remaining
columns are as follows:

\begin{itemize}
\item
  \textbf{Sex}: subject sex (collected by alex at the start of
  experiments).
\item
  \textbf{Age}: subject sex (ditto).
\item
  \textbf{Phase}: experimental phase the trial belongs to.
\item
  \textbf{Trial}: trial number within the phase.
\item
  \textbf{Stimulus}: stimulus presented in the trial (one of those
  defined in the \texttt{Stimuli.csv} design file).
\item
  \textbf{Response}: which key was designated as the correct response.
  Recall that \texttt{space} is a special code for the space bar and
  that the key may be prepended by * (asterisk) if the trial was a
  ``classical conditioning'' one (see \hyperref[responses]{here}).
\item
  \textbf{RewardPr}: reward probability assigned to the stimulus, in
  case of a correct response (from the \texttt{Phases.csv} design file).
\item
  \textbf{Key}: Which key the subject actually pressed. This can be the
  correct key, or any other key that the subject may have pressed (the
  goal is to have a faithful record of everything the subject does).
\item
  \textbf{RT}: Reaction time for this response.
\item
  \textbf{ResponseCount}: The number of responses in this trial, up to
  the current response.
\item
  \textbf{Reward}: The reward received for the response, using the
  following code:
\item
  1: The response was rewarded (the US was presented)
\item
  0: The response was not rewarded (no US presented)
\item
  -1: The response was invalid, i.e., it fell outside of the window
  delimited by ReactionTimeMin and ReactionTimeMax, see above. No US is
  presented on such responses.
\end{itemize}

We believe this information characterizes subject behavior competely,
but please do let us know if you think details could be added.

\section{Troubleshooting}

Errors may arise if Design files have incorrect or incomplete
information. Presently, alex performs some checks at startup, but some
errors are caught only as they occur while running the experiment. We
advise to always run the experiment a few times before putting it into
production. If you think errors are due to bugs in alex, please write us
at the address in \hyperref[contacts]{Contacts}. Also do contact us if
you think that your design files are correct but the experiment does not
run as you expect.

With a few exceptions, all errors print a hopefully informative message
both on the standard console output (terminal) and on screen. A few
errors that may occur before the screen is set up, such as not finding
necessary files, are reported only on the standard output. On Windows,
these messages will appear in files \texttt{stdout.txt} and
\texttt{stderr.txt}, which PEBL creates in the folder where alex is run.

There is one error that appears mysterious to the uninitiated: the
screen remains black and alex hangs forever. The reason is that alex
uses a lock system on the \texttt{Groups.csv} file to prevent concurrent
instances of alex from running the same subject. The lock is held for as
little as possible, but if you interrupt alex at a critical time, or if
alex crashes for any reason before the lock is released, subsequent
instances of alex will wait forever for the lock to be released. In
these cases, you can simply delete the lock file, which is
\texttt{Groups.csv.lck} in the Design folder.

\hyperdef{}{contacts}{\section{Contacts}\label{contacts}}

Please send suggestions to improve alex or this manual to Stefano
Ghirlanda, drghirlanda@gmail.com.

\end{document}
